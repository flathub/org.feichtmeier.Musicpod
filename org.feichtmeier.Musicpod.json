{
    "app-id": "org.feichtmeier.Musicpod",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "23.08",
    "sdk": "org.freedesktop.Sdk",
    "add-extensions": {
        "org.freedesktop.Platform.ffmpeg-full": {
            "directory": "lib/ffmpeg",
            "version": "23.08",
            "add-ld-path": "."
        }
    },
    "cleanup-commands": [
        "mkdir -p /app/lib/ffmpeg"
    ],
    "command": "musicpod",
    "finish-args": [
        "--share=ipc",
        "--share=network",
        "--socket=fallback-x11",
        "--socket=wayland",
        "--filesystem=home",
        "--device=dri",
        "--socket=pulseaudio",
        "--env=TMPDIR=/var/tmp",
        "--own-name=org.mpris.MediaPlayer2.musicpod.*",
        "--talk-name=org.gnome.SessionManager",
        "--system-talk-name=org.freedesktop.NetworkManager"
    ],
    "modules": [
        {
            "name": "libmpv",
            "cleanup": [
                "/include",
                "/lib/pkgconfig",
                "/share/applications",
                "/share/bash-completion",
                "/share/doc",
                "/share/icons",
                "/share/man",
                "/share/zsh"
            ],
            "buildsystem": "meson",
            "config-opts": [
                "-Dbuild-date=false",
                "-Dlibmpv=true",
                "-Dcplayer=false",
                "-Dmanpage-build=disabled",
                "-Dalsa=disabled"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/mpv-player/mpv/archive/v0.38.0.tar.gz",
                    "sha256": "86d9ef40b6058732f67b46d0bbda24a074fae860b3eaae05bab3145041303066",
                    "x-checker-data": {
                        "type": "anitya",
                        "project-id": 5348,
                        "stable-only": true,
                        "url-template": "https://github.com/mpv-player/mpv/archive/v$version.tar.gz"
                    }
                }
            ],
            "modules": [
                {
                    "name": "nv-codec-headers",
                    "cleanup": [
                        "*"
                    ],
                    "no-autogen": true,
                    "make-install-args": [
                        "PREFIX=/app"
                    ],
                    "sources": [
                        {
                            "type": "git",
                            "url": "https://git.videolan.org/git/ffmpeg/nv-codec-headers.git",
                            "tag": "n12.2.72.0",
                            "commit": "c69278340ab1d5559c7d7bf0edf615dc33ddbba7",
                            "x-checker-data": {
                                "type": "git",
                                "tag-pattern": "^n([\\d.]+)$"
                            }
                        }
                    ]
                },
                {
                    "name": "libass",
                    "cleanup": [
                        "/include",
                        "/lib/*.la",
                        "/lib/pkgconfig"
                    ],
                    "config-opts": [
                        "--disable-static"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://github.com/libass/libass/releases/download/0.17.1/libass-0.17.1.tar.xz",
                            "sha256": "f0da0bbfba476c16ae3e1cfd862256d30915911f7abaa1b16ce62ee653192784",
                            "x-checker-data": {
                                "type": "anitya",
                                "project-id": 1560,
                                "stable-only": true,
                                "url-template": "https://github.com/libass/libass/releases/download/$version/libass-$version.tar.xz"
                            }
                        }
                    ]
                },
                {
                    "name": "libplacebo",
                    "cleanup": [
                        "/include",
                        "/lib/*.la",
                        "/lib/pkgconfig"
                    ],
                    "buildsystem": "meson",
                    "config-opts": [
                        "-Dglslang=disabled"
                    ],
                    "sources": [
                        {
                            "type": "git",
                            "url": "https://github.com/haasn/libplacebo.git",
                            "mirror-urls": [
                                "https://code.videolan.org/videolan/libplacebo.git"
                            ],
                            "tag": "v6.338.2",
                            "commit": "64c1954570f1cd57f8570a57e51fb0249b57bb90",
                            "x-checker-data": {
                                "type": "git",
                                "tag-pattern": "^v([\\d.]+)$"
                            }
                        }
                    ]
                },
                {
                    "name": "uchardet",
                    "buildsystem": "cmake-ninja",
                    "config-opts": [
                        "-DCMAKE_BUILD_TYPE=Release",
                        "-DBUILD_STATIC=0"
                    ],
                    "cleanup": [
                        "/bin",
                        "/include",
                        "/lib/pkgconfig",
                        "/share/man"
                    ],
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://www.freedesktop.org/software/uchardet/releases/uchardet-0.0.8.tar.xz",
                            "sha256": "e97a60cfc00a1c147a674b097bb1422abd9fa78a2d9ce3f3fdcc2e78a34ac5f0",
                            "x-checker-data": {
                                "type": "anitya",
                                "project-id": 9265,
                                "stable-only": true,
                                "url-template": "https://www.freedesktop.org/software/uchardet/releases/uchardet-$version.tar.xz"
                            }
                        }
                    ]
                },
                {
                    "name": "squashfs-tools",
                    "cleanup": [
                        "*"
                    ],
                    "buildsystem": "simple",
                    "build-commands": [
                        "XZ_SUPPORT=1 LZO_SUPPORT=0 make -C squashfs-tools -j ${FLATPAK_BUILDER_N_JOBS} install INSTALL_DIR=${FLATPAK_DEST}/bin INSTALL_MANPAGES_DIR=${FLATPAK_DEST}/man/man1"
                    ],
                    "sources": [
                        {
                            "type": "git",
                            "url": "https://github.com/plougher/squashfs-tools.git",
                            "tag": "4.6.1",
                            "commit": "d8cb82d9840330f9344ec37b992595b5d7b44184",
                            "x-checker-data": {
                                "type": "git",
                                "tag-pattern": "^([\\d.]+)$"
                            }
                        }
                    ]
                },
                {
                    "name": "musicpod",
                    "buildsystem": "simple",
                    "build-commands": [
                        "unsquashfs -quiet -no-progress musicpod.snap",
                        "cp -r squashfs-root/bin /app",
                        "install -Dm644 squashfs-root/snap/gui/musicpod.desktop /app/share/applications/org.feichtmeier.Musicpod.desktop",
                        "desktop-file-edit --set-icon='org.feichtmeier.Musicpod' /app/share/applications/org.feichtmeier.Musicpod.desktop",
                        "install -Dm644 squashfs-root/snap/gui/musicpod.png /app/share/icons/hicolor/256x256/apps/org.feichtmeier.Musicpod.png",
                        "install -Dm644 org.feichtmeier.Musicpod.appdata.xml /app/share/metainfo/org.feichtmeier.Musicpod.appdata.xml"
                    ],
                    "cleanup": [
                        "/include",
                        "/lib/pkgconfig",
                        "/share/man"
                    ],
                    "sources": [
                        {
                            "type": "file",
                            "sha256": "0041d0c358f8bcaff80c06968abd3006a4858d39576e22166b0037be320a32b5",
                            "url": "https://raw.githubusercontent.com/ubuntu-flutter-community/musicpod/7b18d03f6699f9fb2eebdcf4ce9a806b260c8bd8/flatpak/org.feichtmeier.Musicpod.appdata.xml"
                        },
                        {
                            "type": "file",
                            "dest-filename": "musicpod.snap",
                            "only-arches": [
                                "x86_64"
                            ],
                            "url": "https://api.snapcraft.io/api/v1/snaps/download/sxdOSGRbzsWhPmGrkYYAs68rzieTrIiv_1197.snap",
                            "sha256": "d95b259e6e4843b6d9c8823ef7de0bf7f424895ca2696ccfabea5609ff66f45a",
                            "x-checker-data": {
                                "type": "snapcraft",
                                "name": "musicpod",
                                "channel": "stable",
                                "architecture": "amd64",
                                "is-main-source": true
                            }
                        },
                        {
                            "type": "file",
                            "dest-filename": "musicpod.snap",
                            "only-arches": [
                                "aarch64"
                            ],
                            "url": "https://api.snapcraft.io/api/v1/snaps/download/sxdOSGRbzsWhPmGrkYYAs68rzieTrIiv_1198.snap",
                            "sha256": "6a5ef48fa48baea9454b26c6ab73cb638994a64c1f4c2f3019fbe191a0f38329",
                            "x-checker-data": {
                                "type": "snapcraft",
                                "name": "musicpod",
                                "channel": "stable",
                                "architecture": "arm64",
                                "is-main-source": true
                            }
                        }
                    ]
                }
            ]
        }
    ]
}
